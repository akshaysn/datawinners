{% load i18n %}
{% block page_js %}
<script type="text/javascript" src="/media/javascript/project/bind_project_links.js"></script>
<script type="text/javascript">


$(document).ready(function(){
    reporter_id = DW.reporter_id;
    is_linked = DW.is_linked;
    reporter_name = DW.reporter_name;
    reporter_html = reporter_name +" ("+ reporter_id +")";

    if (!is_linked){
        $('#edit_ds_popup span select#id_dsid option[value='+ reporter_id +']').addClass("none");
    }

    /*if (!$('#edit_ds_popup span select#id_dsid option[value='+ reporter_id +']').is(':checked')){
        $('#edit_ds_popup span select#id_dsid option[value='+ reporter_id +']').addClass("none");
        $('#edit_ds_popup span select#id_dsid option[value=""]').attr('selected','selected');
    }*/

    $("#edit_ds_popup").dialog({
        title: gettext("Change Data Sender"),
        modal: true,
        autoOpen: false,
        height: 180,
        width: 450
      }
    );

    $("#edit_ds_link").unbind().bind("click", function () {
        $("#edit_ds_popup").dialog("open");
    });

    $("#save_ds").bind("click", function(){
        selected_ds = $('#edit_ds_popup span select#id_dsid option:selected').text();
        selected_ds_split = selected_ds.split("  ");
        datasender_name = selected_ds_split[0].replace(/^\w/, function($0) { return $0.toUpperCase(); });
        datasender_id = selected_ds_split[1].replace(')','').replace('(','')
        alert(datasender_name+"/"+datasender_id)
        $(".datasender").text(datasender_id);
         $(".ds_id").text(datasender_name);
        $("#edit_ds_popup").dialog("close");

        $('#choice_field_hidden span select#id_dsid option[value="'+datasender_id+'"]').attr('selected','selected');
    });

    if (($(".datasender").html() == reporter_id) && !is_linked){
        $("#text").text(gettext("The Data Sender "+reporter_name+" ("+reporter_id+") is not linked to your Questionnaire"));
        $('#edit_ds_popup span select#id_dsid option[value='+ reporter_id +']').addClass("none");
        $('#edit_ds_popup span select#id_dsid option[value=""]').attr('selected','selected');
    }
    if ($(".datasender").html() != reporter_id){
        $('#edit_ds_popup span select#id_dsid option[value=""]').addClass("none");
    }

    });

</script>
{% endblock %}

<div id="static-info" class="padding_top_10 padding_bottom_10">
    <ul>
        {% for header,value in static_content.items %}
            <li class="info">
                <text class='content-header'>{% trans header %}</text>
                {% if header == 'Data Sender' %}
                    <text class='ds_id'>{{ value.0 }}</text>
                    <text class='datasender'>{{ value.1 }}</text>
                    <a id="edit_ds_link" class="margin_left_10">Change</a><br/>

                {% else %}
                    <text class='content-values'>{{ value }}</text>
                {% endif %}
                <span id="text" class="error_message"></span>
            </li>

        {% endfor %}
        <li class="info">
            {% if is_error_to_success %}
                <text class='highlight content-header'>{% trans 'Status' %}</text>
                <img class="device-icon" src="/media/images/success_check.png" alt="Success">
                <text class='highlight content-values'>{{ status }}</text>
            {% else %}
                <text class='content-header'>{% trans 'Status' %}</text>
                <text class='content-values'>{{ status}}</text>
            {% endif %}
        </li>
    </ul>
<div id="edit_ds_popup">
    <span class="margin_bottom_20">Which registered Data Sender sent you this Submission?</span></br>
    {% for field in questionnaire_form %}
        {% if not field.is_hidden %}
            {% if field.name == 'dsid' %}
                 <span id="choice_field">
                        {{ field }}
                 </span></br></br>
            {% endif %}
        {% endif %}
    {% endfor %}

        <span id="number" class="margin_left_10 none"></span>
        <a href="#" class="button margin_top_13 float_right" id="save_ds" style="float: right">{% trans "Change" %}</a>
        <a href="#" class="margin_top_20 cancel_link float_right">{% trans "Cancel" %}</a></br>
</div>
<div id="choice_field_hidden" class="none">
    {% for field in questionnaire_form %}
        {% if not field.is_hidden %}
            {% if field.name == 'dsid' %}
                 <span>
                        {{ field }}
                 </span>
            {% endif %}
        {% endif %}
    {% endfor %}
</div>
</div>




